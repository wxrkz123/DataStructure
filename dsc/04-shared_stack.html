<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>共享栈教学演示器</title>
    
    <!-- Dependencies -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@formkit/auto-animate@0.8.2/index.global.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .operation-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            outline: none;
        }
        
        .operation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .operation-btn:active {
            transform: translateY(0);
        }
        
        .stack-element {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            cursor: pointer;
            min-height: 96px;
        }
        
        .stack-element:hover {
            transform: translateY(-5px) scale(1.05);
            z-index: 10;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .stack-element.empty {
            border: 2px dashed #d1d5db;
            background: #f9fafb;
        }
        
        .stack-element.stack0 {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: 2px solid #1e40af;
            color: white;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }
        
        .stack-element.stack1 {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border: 2px solid #991b1b;
            color: white;
            box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
        }
        
        @keyframes pushAnimation {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.1) rotate(90deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        @keyframes popAnimation {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            100% { transform: scale(0) rotate(-180deg); opacity: 0; }
        }
        
        .push-animation {
            animation: pushAnimation 0.5s ease-out;
        }
        
        .pop-animation {
            animation: popAnimation 0.5s ease-out;
        }
        
        .pointer-indicator {
            position: absolute;
            font-size: 24px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .slider-track {
            background: linear-gradient(to right, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container mx-auto p-6 max-w-7xl">
            <!-- 标题 -->
            <div class="text-center mb-8">
                <h1 class="text-5xl font-bold text-white mb-2">现代共享栈浏览器</h1>
                <p class="text-white/80 text-lg">在单个数组中实现两个栈，高效利用存储空间</p>
            </div>
            
            <!-- 主面板 -->
            <div class="glass-card p-6 mb-6">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- 操作面板 -->
                    <div class="lg:col-span-1">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">操作面板</h2>
                        
                        <!-- 栈选择 -->
                        <div class="mb-6">
                            <div class="flex gap-2 mb-4">
                                <button 
                                    @click="selectedStack = 0"
                                    :class="['flex-1 py-3 px-4 rounded-lg font-semibold operation-btn', 
                                             selectedStack === 0 ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700']">
                                    栈 0
                                </button>
                                <button 
                                    @click="selectedStack = 1"
                                    :class="['flex-1 py-3 px-4 rounded-lg font-semibold operation-btn',
                                             selectedStack === 1 ? 'bg-red-500 text-white' : 'bg-gray-200 text-gray-700']">
                                    栈 1
                                </button>
                            </div>
                            
                            <!-- 输入框 -->
                            <input 
                                v-model="inputValue"
                                @keyup.enter="push"
                                type="text" 
                                placeholder="输入要压入的值"
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none text-lg">
                        </div>
                        
                        <!-- 操作按钮 -->
                        <div class="grid grid-cols-2 gap-3 mb-6">
                            <button 
                                @click="push"
                                :disabled="isFull"
                                :class="['py-3 px-4 rounded-lg font-semibold operation-btn',
                                         isFull ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-green-500 text-white hover:bg-green-600']">
                                入栈 (Push)
                            </button>
                            <button 
                                @click="pop"
                                :disabled="isEmpty"
                                :class="['py-3 px-4 rounded-lg font-semibold operation-btn',
                                         isEmpty ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-orange-500 text-white hover:bg-orange-600']">
                                出栈 (Pop)
                            </button>
                            <button 
                                @click="peek"
                                :disabled="isEmpty"
                                :class="['py-3 px-4 rounded-lg font-semibold operation-btn',
                                         isEmpty ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-purple-500 text-white hover:bg-purple-600']">
                                查看栈顶 (Peek)
                            </button>
                            <button 
                                @click="clear"
                                :disabled="isEmpty"
                                :class="['py-3 px-4 rounded-lg font-semibold operation-btn',
                                         isEmpty ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-red-500 text-white hover:bg-red-600']">
                                清空栈 (Clear)
                            </button>
                        </div>
                        
                        <!-- 批量操作 -->
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold mb-2">批量操作</h3>
                            <button 
                                @click="randomPush"
                                class="w-full py-3 px-4 rounded-lg font-semibold bg-indigo-500 text-white hover:bg-indigo-600 operation-btn">
                                随机压入5个元素
                            </button>
                        </div>
                    </div>
                    
                    <!-- 查看与管理 -->
                    <div class="lg:col-span-2">
                        <h2 class="text-2xl font-bold mb-4 text-gray-800">查看 & 管理</h2>
                        
                        <!-- 容量控制 -->
                        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-lg font-semibold">总容量：</label>
                                <span class="text-2xl font-bold text-purple-600">{{ maxSize }}</span>
                            </div>
                            <input 
                                type="range" 
                                v-model="maxSize"
                                @change="resizeStack"
                                min="4" 
                                max="12" 
                                class="w-full h-2 rounded-lg appearance-none cursor-pointer slider-track">
                        </div>
                        
                        <!-- 重置栈空间按钮 -->
                        <button 
                            @click="resetStack"
                            class="w-full py-3 px-4 rounded-lg font-semibold bg-gray-700 text-white hover:bg-gray-800 operation-btn mb-6">
                            重置栈空间
                        </button>
                        
                        <!-- 栈状态信息 -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h3 class="text-lg font-semibold text-blue-700 mb-2">栈 0 (从左到右)</h3>
                                <div class="space-y-1">
                                    <p>Top₀: <span class="font-bold text-xl">{{ top0 }}</span></p>
                                    <p>Size₀: <span class="font-bold text-xl">{{ size0 }}</span></p>
                                    <p>状态: <span class="font-bold">{{ stack0Status }}</span></p>
                                </div>
                            </div>
                            <div class="p-4 bg-red-50 rounded-lg">
                                <h3 class="text-lg font-semibold text-red-700 mb-2">栈 1 (从右到左)</h3>
                                <div class="space-y-1">
                                    <p>Top₁: <span class="font-bold text-xl">{{ top1 }}</span></p>
                                    <p>Size₁: <span class="font-bold text-xl">{{ size1 }}</span></p>
                                    <p>状态: <span class="font-bold">{{ stack1Status }}</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 共享存储空间可视化 -->
            <div class="glass-card p-6">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 text-center">共享存储空间</h2>
                <div class="text-center mb-4">
                    <span class="text-sm text-gray-600">可用: {{ availableSpace }} 个栈槽 | 栈满: {{ isFull ? '是' : '否' }}</span>
                </div>
                
                <!-- 栈元素展示 -->
                <div class="relative max-w-4xl mx-auto">
                    <!-- Top指针指示器 -->
                    <div v-if="top0 >= 0" 
                         class="pointer-indicator text-blue-500"
                         :style="{left: `calc(${(top0 + 0.5) * (100 / maxSize)}% - 30px)`, top: '-40px'}">
                        ↓ Top₀
                    </div>
                    <div v-if="top1 < maxSize" 
                         class="pointer-indicator text-red-500"
                         :style="{left: `calc(${(top1 + 0.5) * (100 / maxSize)}% - 30px)`, top: '-40px'}">
                        ↓ Top₁
                    </div>
                    
                    <div class="grid gap-2" :style="{gridTemplateColumns: `repeat(${maxSize}, 1fr)`}">
                        <div v-for="(element, index) in sharedStack" 
                             :key="index"
                             :ref="'element-' + index"
                             @click="showElementInfo(index)"
                             :class="['stack-element h-24 rounded-lg flex flex-col items-center justify-center font-bold text-lg relative cursor-pointer',
                                      element.stack === 0 ? 'stack0' : element.stack === 1 ? 'stack1' : 'empty']">
                            <div v-if="element.value !== null" class="text-2xl">
                                {{ element.value }}
                            </div>
                            <div class="text-xs mt-1 opacity-75">
                                [{{ index }}]
                            </div>
                        </div>
                    </div>
                    
                    <!-- 地址标签 -->
                    <div class="grid gap-2 mt-2" :style="{gridTemplateColumns: `repeat(${maxSize}, 1fr)`}">
                        <div v-for="i in maxSize" :key="'addr-' + i" class="text-center text-xs text-gray-500">
                            地址: {{ i - 1 }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 操作历史 -->
            <div class="glass-card p-6 mt-6">
                <h2 class="text-2xl font-bold mb-4 text-gray-800">操作历史</h2>
                <div class="max-h-40 overflow-y-auto">
                    <div v-if="history.length === 0" class="text-gray-500 text-center py-4">
                        暂无操作记录
                    </div>
                    <div v-else class="space-y-2">
                        <div v-for="(record, index) in history" 
                             :key="index"
                             class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                            <span :class="['font-semibold', record.stack === 0 ? 'text-blue-600' : 'text-red-600']">
                                栈{{ record.stack }}
                            </span>
                            <span class="text-gray-700">{{ record.operation }}</span>
                            <span v-if="record.value !== undefined" class="font-mono">值: {{ record.value }}</span>
                            <span class="text-gray-500 text-sm">{{ record.time }}</span>
                        </div>
                    </div>
                </div>
                <button v-if="history.length > 0" 
                        @click="clearHistory"
                        class="mt-3 text-sm text-gray-500 hover:text-gray-700">
                    清除历史
                </button>
            </div>
        </div>
    </div>
    
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    maxSize: 8,
                    sharedStack: [],
                    top0: -1,
                    top1: 8,
                    selectedStack: 0,
                    inputValue: '',
                    history: [],
                    notyf: null
                }
            },
            computed: {
                size0() {
                    return this.top0 + 1;
                },
                size1() {
                    return this.maxSize - this.top1;
                },
                isFull() {
                    return this.top0 + 1 >= this.top1;
                },
                isEmpty() {
                    if (this.selectedStack === 0) {
                        return this.top0 === -1;
                    } else {
                        return this.top1 === this.maxSize;
                    }
                },
                availableSpace() {
                    return this.top1 - this.top0 - 1;
                },
                stack0Status() {
                    if (this.top0 === -1) return '空';
                    if (this.top0 + 1 >= this.top1) return '满';
                    return '正常';
                },
                stack1Status() {
                    if (this.top1 === this.maxSize) return '空';
                    if (this.top0 + 1 >= this.top1) return '满';
                    return '正常';
                }
            },
            methods: {
                initStack() {
                    this.sharedStack = Array(this.maxSize).fill(null).map(() => ({
                        value: null,
                        stack: null
                    }));
                    this.top0 = -1;
                    this.top1 = this.maxSize;
                },
                
                push() {
                    if (!this.inputValue.trim()) {
                        this.notyf.dismissAll();
                        this.notyf.error('请输入要压入的值');
                        return;
                    }
                    
                    if (this.isFull) {
                        this.notyf.dismissAll();
                        this.notyf.error('栈已满，无法继续压入');
                        return;
                    }
                    
                    const value = this.inputValue.trim();
                    this.notyf.dismissAll();
                    
                    if (this.selectedStack === 0) {
                        this.top0++;
                        this.sharedStack[this.top0] = {
                            value: value,
                            stack: 0
                        };
                        this.$nextTick(() => {
                            const element = this.$refs['element-' + this.top0]?.[0];
                            if (element) {
                                element.classList.add('push-animation');
                                setTimeout(() => element.classList.remove('push-animation'), 500);
                            }
                        });
                        this.addHistory(0, 'PUSH', value);
                        this.notyf.success(`已将 "${value}" 压入栈0`);
                    } else {
                        this.top1--;
                        this.sharedStack[this.top1] = {
                            value: value,
                            stack: 1
                        };
                        this.$nextTick(() => {
                            const element = this.$refs['element-' + this.top1]?.[0];
                            if (element) {
                                element.classList.add('push-animation');
                                setTimeout(() => element.classList.remove('push-animation'), 500);
                            }
                        });
                        this.addHistory(1, 'PUSH', value);
                        this.notyf.success(`已将 "${value}" 压入栈1`);
                    }
                    
                    this.inputValue = '';
                },
                
                pop() {
                    if (this.isEmpty) {
                        this.notyf.dismissAll();
                        this.notyf.error(`栈${this.selectedStack}为空，无法出栈`);
                        return;
                    }
                    
                    this.notyf.dismissAll();
                    
                    if (this.selectedStack === 0) {
                        const element = this.$refs['element-' + this.top0]?.[0];
                        if (element) {
                            element.classList.add('pop-animation');
                        }
                        
                        const value = this.sharedStack[this.top0].value;
                        setTimeout(() => {
                            this.sharedStack[this.top0] = { value: null, stack: null };
                            this.top0--;
                        }, 400);
                        
                        this.addHistory(0, 'POP', value);
                        this.notyf.success(`已从栈0弹出 "${value}"`);
                    } else {
                        const element = this.$refs['element-' + this.top1]?.[0];
                        if (element) {
                            element.classList.add('pop-animation');
                        }
                        
                        const value = this.sharedStack[this.top1].value;
                        setTimeout(() => {
                            this.sharedStack[this.top1] = { value: null, stack: null };
                            this.top1++;
                        }, 400);
                        
                        this.addHistory(1, 'POP', value);
                        this.notyf.success(`已从栈1弹出 "${value}"`);
                    }
                },
                
                peek() {
                    if (this.isEmpty) {
                        this.notyf.dismissAll();
                        this.notyf.error(`栈${this.selectedStack}为空`);
                        return;
                    }
                    
                    this.notyf.dismissAll();
                    
                    if (this.selectedStack === 0) {
                        const value = this.sharedStack[this.top0].value;
                        this.notyf.success(`栈0栈顶元素: "${value}"`);
                        this.addHistory(0, 'PEEK', value);
                    } else {
                        const value = this.sharedStack[this.top1].value;
                        this.notyf.success(`栈1栈顶元素: "${value}"`);
                        this.addHistory(1, 'PEEK', value);
                    }
                },
                
                clear() {
                    if (this.isEmpty) {
                        this.notyf.dismissAll();
                        this.notyf.error(`栈${this.selectedStack}已经为空`);
                        return;
                    }
                    
                    this.notyf.dismissAll();
                    
                    if (this.selectedStack === 0) {
                        for (let i = 0; i <= this.top0; i++) {
                            this.sharedStack[i] = { value: null, stack: null };
                        }
                        this.top0 = -1;
                        this.addHistory(0, 'CLEAR');
                        this.notyf.success('已清空栈0');
                    } else {
                        for (let i = this.top1; i < this.maxSize; i++) {
                            this.sharedStack[i] = { value: null, stack: null };
                        }
                        this.top1 = this.maxSize;
                        this.addHistory(1, 'CLEAR');
                        this.notyf.success('已清空栈1');
                    }
                },
                
                randomPush() {
                    const items = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J'];
                    let count = 0;
                    const maxCount = Math.min(5, this.availableSpace);
                    
                    if (maxCount === 0) {
                        this.notyf.error('栈已满，无法继续压入');
                        return;
                    }
                    
                    const interval = setInterval(() => {
                        if (count >= maxCount || this.isFull) {
                            clearInterval(interval);
                            return;
                        }
                        
                        this.inputValue = items[Math.floor(Math.random() * items.length)] + 
                                         Math.floor(Math.random() * 100);
                        this.push();
                        count++;
                    }, 300);
                },
                
                resetStack() {
                    this.initStack();
                    this.history = [];
                    this.notyf.success('栈空间已重置');
                },
                
                resizeStack() {
                    this.initStack();
                    this.history = [];
                    this.notyf.success(`栈容量已调整为 ${this.maxSize}`);
                },
                
                showElementInfo(index) {
                    const element = this.sharedStack[index];
                    // 清除之前的所有通知
                    this.notyf.dismissAll();
                    
                    if (element.value === null) {
                        this.notyf.open({
                            type: 'info',
                            message: `地址[${index}]: 空闲空间`,
                            duration: 2000
                        });
                    } else {
                        this.notyf.open({
                            type: 'info',
                            message: `地址[${index}]: 值="${element.value}", 属于栈${element.stack}`,
                            duration: 2000
                        });
                    }
                },
                
                addHistory(stack, operation, value) {
                    const now = new Date();
                    this.history.unshift({
                        stack,
                        operation,
                        value,
                        time: `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`
                    });
                    
                    if (this.history.length > 10) {
                        this.history.pop();
                    }
                },
                
                clearHistory() {
                    this.history = [];
                    this.notyf.success('操作历史已清除');
                }
            },
            mounted() {
                this.notyf = new Notyf({
                    duration: 2000,
                    position: { x: 'right', y: 'top' },
                    dismissible: true,
                    ripple: false,
                    types: [
                        {
                            type: 'info',
                            background: '#667eea',
                            icon: false
                        }
                    ]
                });
                
                this.initStack();
                
                // 添加 Tippy.js 提示
                this.$nextTick(() => {
                    tippy('[ref^="element-"]', {
                        content: '点击查看元素详情',
                        placement: 'top',
                        animation: 'scale'
                    });
                });
                
                // 自动动画元素
                const animatedElements = document.querySelectorAll('.stack-element');
                autoAnimate(document.querySelector('.grid'));
            }
        }).mount('#app');
    </script>
</body>
</html>